# $OpenLDAP$
## Copyright 1998-2000 The OpenLDAP Foundation, All Rights Reserved.
## COPYING RESTRICTIONS APPLY, see COPYRIGHT file
#-----------------------------------------------------------------------------
# Portions Copyright (c) 1995 Regents of the University of Michigan.
# All rights reserved.
#
# Redistribution and use in source and binary forms are permitted
# provided that this notice is preserved and that due credit is given
# to the University of Michigan at Ann Arbor. The name of the University
# may not be used to endorse or promote products derived from this
# software without specific prior written permission. This software
# is provided ``as is'' without express or implied warranty.
#
#       Stand alone LDAP server tools makefile
#
#-----------------------------------------------------------------------------
BUILD_LDBM = @BUILD_LDBM@

LDAP_INCDIR= ../../../include       
LDAP_LIBDIR= ../../../libraries

SLAP_DIR=../
SLAPD_MODULES = @SLAPD_MODULES_LIST@
XDEFS = $(MODULES_CPPFLAGS)
XLDFLAGS = $(MODULES_LDFLAGS) $(SLAPD_MODULES)

XLIBS = -lavl -lldif -lldbm -llutil -lldap_r -llber
XXLIBS = $(SLAPD_LIBS) \
	$(LDBM_LIBS) $(SECURITY_LIBS) \
	$(LDIF_LIBS) $(LUTIL_LIBS)
XXXLIBS = $(MODULES_LIBS) $(LTHREAD_LIBS)

PROGRAMS=slapadd slapcat slapindex slappasswd

# CPPFLAGS will include the defines for dynamic libs in Mingw32.
NT_DYN_DEFS = -DLBER_DECL=dllimport -DLDAP_DECL=dllimport
CPPFLAGS = $(@PLAT@_@LIB_LINKAGE@_DEFS)

SRCS = mimic.c slapcommon.c \
	slapadd.c slapcat.c slapindex.c slappasswd.c

SLAPD_OBJS = ../config.o ../ch_malloc.o ../backend.o ../charray.o \
		../module.o ../aclparse.o ../filterentry.o \
		../schema.o ../schema_check.o ../schema_init.o ../schema_prep.o \
		../schemaparse.o ../ad.o ../at.o ../mr.o ../oc.o ../syntax.o \
		../acl.o ../phonetic.o ../attr.o ../value.o ../entry.o \
		../dn.o ../filter.o ../str2filter.o ../ava.o ../init.o \
		../controls.o ../kerberos.o ../passwd.o ../index.o \
		../extended.o ../starttls.o

SLAPOBJS = $(SLAPD_OBJS) slapcommon.o mimic.o

all-local: build-progs

build-progs: $(PROGRAMS)

#
# SLAP Tools
#
slapadd:	slapadd.o ../libbackends.a $(SLAPOBJS) $(SLAPD_LIBDEPEND) 
	$(LTLINK) -o $@ slapadd.o $(SLAPOBJS) ../libbackends.a $(LIBS)

slapcat:	slapcat.o ../libbackends.a $(SLAPOBJS) $(SLAPD_LIBDEPEND) 
	$(LTLINK) -o $@ slapcat.o $(SLAPOBJS) ../libbackends.a $(LIBS)

slapindex:	slapindex.o ../libbackends.a $(SLAPOBJS) $(SLAPD_LIBDEPEND) 
	$(LTLINK) -o $@ slapindex.o $(SLAPOBJS) ../libbackends.a $(LIBS)

slappasswd:		slappasswd.o $(SLAPD_LIBDEPEND) 
	$(LTLINK) -o $@ slappasswd.o $(LIBS)

clean-local: FORCE
	$(RM) $(PROGRAMS) $(XPROGRAMS) $(XSRCS) *.o core .libs/* *.exe

depend-local: FORCE
	$(MKDEP) $(DEFS) $(DEFINES) $(SRCS)
