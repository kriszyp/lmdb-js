# $OpenLDAP$
##
## Makefile for LDAP tools
##
SRCS	= ldapsearch.c ldapmodify.c ldapdelete.c ldapmodrdn.c ldappasswd.c
OBJS	= ldapsearch.o ldapmodify.o ldapdelete.o ldapmodrdn.o ldappasswd.o

LDAP_INCDIR= ../../include       
LDAP_LIBDIR= ../../libraries

NT_DYN_DEFS = -DLIBLBER_DECL=dllimport -DLIBLDAP_DECL=dllimport
CPPFLAGS = $(@PLAT@_@LIB_LINKAGE@_DEFS)

XLIBS =  -llutil -lldif -lldap -llber
XXLIBS	= $(SECURITY_LIBS) $(LDIF_LIBS) $(LUTIL_LIBS)

XSRCS	= ldsversion.c ldmversion.c lddversion.c ldrversion.c ldpversion.c

PROGRAMS = ldapsearch ldapmodify ldapdelete ldapmodrdn ldapadd ldappasswd

ldapsearch:	ldsversion.o
	$(LTLINK) -o $@ ldapsearch.o ldsversion.o $(LIBS)

ldapmodify:	ldmversion.o
	$(LTLINK) -o $@ ldapmodify.o ldmversion.o $(LIBS)

ldapdelete:	lddversion.o
	$(LTLINK) -o $@ ldapdelete.o lddversion.o $(LIBS)

ldapmodrdn:	ldrversion.o
	$(LTLINK) -o $@ ldapmodrdn.o ldrversion.o $(LIBS)

ldappasswd:	ldpversion.o
	$(LTLINK) -o $@ ldappasswd.o ldpversion.o $(LIBS)

ldapadd:	ldapmodify
	@-$(RM) $@$(EXEEXT)
	$(LN_H) ldapmodify$(EXEEXT) ldapadd$(EXEEXT)

ldsversion.c: ldapsearch.o $(LDAP_LIBDEPEND)
	@-$(RM) $@
	$(MKVERSION) ldapsearch > $@

ldmversion.c: ldapmodify.o $(LDAP_LIBDEPEND)
	@-$(RM) $@
	$(MKVERSION) ldapmodify > $@

lddversion.c: ldapdelete.o $(LDAP_LIBDEPEND)
	@-$(RM) $@
	$(MKVERSION) ldapdelete > $@

ldpversion.c: ldappasswd.o $(LDAP_LIBDEPEND)
	@-$(RM) $@
	$(MKVERSION) ldappasswd > $@

ldrversion.c: ldapmodrdn.o $(LDAP_LIBDEPEND)
	@-$(RM) $@
	$(MKVERSION) ldapmodrdn > $@

install-local:	FORCE
	-$(MKDIR) $(DESTDIR)$(bindir)
	@(								\
	    for prg in $(PROGRAMS); do					\
		$(LTINSTALL) $(INSTALLFLAGS) -s -m 755 $$prg$(EXEEXT)	\
		    $(DESTDIR)$(bindir);				\
	    done							\
	)
	$(RM) $(DESTDIR)$(bindir)/ldapadd$(EXEEXT)
	$(LN) $(DESTDIR)$(bindir)/ldapmodify$(EXEEXT) $(DESTDIR)$(bindir)/ldapadd$(EXEEXT)

